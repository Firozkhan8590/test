<!DOCTYPE html>
<html>
<head>
    <title>URL Shortener</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-blue-100 min-h-screen flex flex-col items-center justify-center">
    <div class="bg-white/90 shadow-2xl rounded-2xl p-10 w-full max-w-lg mt-12 border border-blue-100">
        <h1 class="text-3xl font-extrabold text-center mb-8 text-blue-700 tracking-tight">URL Shortener</h1>
        
        <form method="POST" class="flex flex-col gap-5">{% csrf_token %}
            <label class="block text-gray-700 font-semibold text-sm">
                Long URL
                <input type="text" name="long_url" required placeholder="Paste your long URL here..." class="mt-2 w-full px-4 py-2 border border-gray-200 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 transition">
            </label>
            <div class="flex gap-3">
                <button type="submit" class="bg-blue-600 text-white py-2 rounded-lg font-semibold hover:bg-blue-700 transition flex-1 shadow">Shorten</button>
                <a href="{% url 'home' %}" class="bg-gray-200 text-gray-700 py-2 rounded-lg font-semibold hover:bg-gray-300 transition flex-1 text-center shadow">Refresh</a>
            </div>
        </form>

        {% if short_url %}
        <div class="mt-8 bg-green-50 border border-green-200 rounded-lg p-5 text-center shadow">
            <p class="text-green-700 font-bold mb-2">Short URL</p>
            <a href="{{ short_url }}" class="text-blue-700 underline break-all font-mono text-lg hover:text-blue-900 transition">{{ short_url }}</a>
        </div>
        {% endif %}

        <h2 class="text-xl font-bold mt-10 mb-4 text-gray-800 border-b pb-2">All URLs</h2>
        <ul class="space-y-3 max-h-72 overflow-y-auto pr-1">
        {% for url in urls %}
            <li class="flex items-center justify-between bg-white px-4 py-3 rounded-lg border border-gray-100 shadow-sm hover:shadow-md transition">
                <div class="flex flex-col">
                    <span class="font-mono text-blue-500 text-sm">{{ url.short_code }}</span>
                    <a href="{{ url.long_url }}" class="text-gray-800 underline break-all text-sm hover:text-blue-700 transition">{{ url.long_url }}</a>
                    <span class="text-xs text-gray-400 mt-1">Clicks: {{ url.clicks }}</span>
                </div>
                <button 
                    type="button"
                    class="ml-4 bg-red-500 text-white px-3 py-1.5 rounded-lg font-semibold text-xs hover:bg-red-600 transition shadow"
                    onclick="openModal('{{ url.id }}', '{{ url.short_code }}')"
                >Delete</button>
            </li>
        {% empty %}
            <li class="text-gray-400 text-center">No URLs yet.</li>
        {% endfor %}
        </ul>
    </div>

    <!-- Modal -->
    <div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl p-8 w-full max-w-sm text-center">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Confirm Deletion</h3>
            <p class="mb-6 text-gray-600">Are you sure you want to delete <span id="modalShortCode" class="font-mono text-blue-600"></span>?</p>
            <form id="deleteForm" method="post" action="">
                {% csrf_token %}
                <div class="flex gap-4 justify-center">
                    <button type="button" onclick="closeModal()" class="px-4 py-2 rounded bg-gray-200 text-gray-700 font-semibold hover:bg-gray-300 transition">Cancel</button>
                    <button type="submit" class="px-4 py-2 rounded bg-red-600 text-white font-semibold hover:bg-red-700 transition">Delete</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function openModal(urlId, shortCode) {
            document.getElementById('deleteModal').classList.remove('hidden');
            document.getElementById('modalShortCode').textContent = shortCode;
            document.getElementById('deleteForm').action = `{% url 'delete_url' 0 %}`.replace('0', urlId);
        }
        function closeModal() {
            document.getElementById('deleteModal').classList.add('hidden');
        }
        // Optional: Close modal on ESC key
        document.addEventListener('keydown', function(e) {
            if (e.key === "Escape") closeModal();
        });
    </script>
</body>
</html>
